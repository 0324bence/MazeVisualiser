var I=Object.defineProperty;var O=(i,t,e)=>t in i?I(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>(O(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const d=class{};let s=d;l(s,"SIZE",800),l(s,"CELL_COUNT",20),l(s,"CELL_SIZE",d.SIZE/d.CELL_COUNT),l(s,"FPS",60),l(s,"CUSTOMS",{startPos:[5,5],endPos:[d.CELL_COUNT-4,d.CELL_COUNT-4],useDiagonals:!0,showCoords:!1,framesBettweenSteps:5,showGrid:!1});class b{constructor(t){this.ctx=t}}var n=(i=>(i[i.Empty=0]="Empty",i[i.Start=1]="Start",i[i.End=2]="End",i[i.Wall=3]="Wall",i[i.Route=4]="Route",i[i.Open=5]="Open",i[i.Closed=6]="Closed",i[i.Current=7]="Current",i))(n||{});class x extends b{constructor(e,o,r){super(e);l(this,"type",0);l(this,"_data",{});this.col=o,this.row=r}get data(){return this._data}set data(e){this._data=e}Draw(){switch(this.type){case 0:this.ctx.fillStyle="#fff";break;case 1:this.ctx.fillStyle="#0f0";break;case 2:this.ctx.fillStyle="#f00";break;case 3:this.ctx.fillStyle="#000";break;case 4:this.ctx.fillStyle="#f0f";break;case 5:this.ctx.fillStyle="#0ef";break;case 6:this.ctx.fillStyle="#05f";break;case 7:this.ctx.fillStyle="yellow";break}this.ctx.fillRect(this.col*s.CELL_SIZE,this.row*s.CELL_SIZE,s.CELL_SIZE,s.CELL_SIZE),s.CUSTOMS.showGrid&&(this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.rect(this.col*s.CELL_SIZE,this.row*s.CELL_SIZE,s.CELL_SIZE,s.CELL_SIZE),this.ctx.stroke()),this.ctx.font=`${s.CELL_SIZE/2/2}px Arial`,this.ctx.fillStyle="#000";const e=`${this.row} ${this.col}`,o=this.ctx.measureText(e);s.CUSTOMS.showCoords&&this.ctx.fillText(e,this.col*s.CELL_SIZE+(s.CELL_SIZE-o.width)/2,this.row*s.CELL_SIZE+(s.CELL_SIZE+(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent))/2)}}class P{constructor(t,e,o){this.grid=t,this.startCoords=e,this.endCoords=o}getValidNeighbours(t){const e=[this.grid[t.row-1]&&this.grid[t.col-1]&&this.grid[t.row-1][t.col-1],this.grid[t.row+1]&&this.grid[t.col-1]&&this.grid[t.row+1][t.col-1],this.grid[t.row-1]&&this.grid[t.col+1]&&this.grid[t.row-1][t.col+1],this.grid[t.row+1]&&this.grid[t.col+1]&&this.grid[t.row+1][t.col+1]];return[this.grid[t.row-1]&&this.grid[t.row-1][t.col],this.grid[t.row+1]&&this.grid[t.row+1][t.col],this.grid[t.row]&&this.grid[t.row][t.col-1],this.grid[t.row]&&this.grid[t.row][t.col+1],...s.CUSTOMS.useDiagonals?e:[]].filter(Boolean)}}class U extends P{constructor(e,o,r){super(e,o,r);l(this,"foundPath",0);l(this,"currentIteration",0)}Step(){const e=this.grid[this.startCoords[0]][this.startCoords[1]];e.data.distance=0;const o=this.grid.reduce((r,a)=>r.concat(a.filter(c=>c.type===n.Open)),[]);if(this.currentIteration==0&&o.push(e),o.length==0)return!0;this.currentIteration++;for(let r of o){const a=this.getValidNeighbours(r);for(let c of a){if(c.type==n.End&&this.foundPath==0){this.grid[this.endCoords[0]][this.endCoords[1]].data.distance=this.currentIteration+1,this.foundPath=this.currentIteration;break}c.type==n.Empty&&(c.type=n.Open)}r.data={distance:this.currentIteration},r.type!=n.Start&&(r.type=n.Closed)}return this.currentIteration>this.foundPath&&this.foundPath>0?(console.log("finish "),!0):!1}Finish(){if(!this.foundPath)return;const e=this.grid[this.endCoords[0]][this.endCoords[1]];this.grid[this.startCoords[0]][this.startCoords[1]].data.distance=0;let o=e,r=this.currentIteration;for(;r>0;){const a=this.getValidNeighbours(o);for(let c of a)if(c.data.distance<r){c.type!=n.Start&&(c.type=n.Route),r=c.data.distance,o=c;break}}}InstantSolve(){for(let e of this.grid)for(let o of e)o.data={},o.type!=n.Start&&o.type!=n.End&&o.type!=n.Wall&&(o.type=n.Empty);for(this.currentIteration=0,this.foundPath=0;!this.Step(););this.Finish()}}class k{constructor(t,e){l(this,"cells",new Array(s.CELL_COUNT));l(this,"isRunning",!1);l(this,"pathFinding");l(this,"isFinished",!1);l(this,"clickStartCellType",n.Empty);this.ctx=t,this.canvas=e,this.InitPathFinder(),this.Reset()}Reset(){this.isRunning=!1,this.isFinished=!1;for(let t=0;t<s.CELL_COUNT;t++){this.cells[t]=new Array(s.CELL_COUNT);for(let e=0;e<s.CELL_COUNT;e++)this.cells[t][e]=new x(this.ctx,e,t)}this.InitPathFinder(),this.cells[s.CUSTOMS.startPos[0]][s.CUSTOMS.startPos[1]].type=n.Start,this.cells[s.CUSTOMS.endPos[0]][s.CUSTOMS.endPos[1]].type=n.End,document.getElementById("useDiagonalsCheckbox").removeAttribute("disabled")}InitPathFinder(){this.pathFinding=new U(this.cells,s.CUSTOMS.startPos,s.CUSTOMS.endPos)}GetCellAtPixelCoords(t,e){const o=this.canvas.getBoundingClientRect(),r=t-o.left,a=e-o.top,c=Math.floor(r/s.CELL_SIZE),f=Math.floor(a/s.CELL_SIZE);if(!(c<0||c>=s.CELL_COUNT||f<0||f>=s.CELL_COUNT))return this.cells[f][c]}Click(t){const e=this.GetCellAtPixelCoords(t.clientX,t.clientY);e&&(this.clickStartCellType=e.type,this.Move(t))}Move(t){if(!this.isRunning&&t.buttons===1){const e=this.GetCellAtPixelCoords(t.clientX,t.clientY);if(!e)return;const o=this.cells[s.CUSTOMS.startPos[0]][s.CUSTOMS.startPos[1]],r=this.cells[s.CUSTOMS.endPos[0]][s.CUSTOMS.endPos[1]];switch(this.clickStartCellType){case n.Start:if(e.type==n.End||e.type==n.Wall)return;o.type=n.Empty,e.type=n.Start,s.CUSTOMS.startPos=[e.row,e.col],this.InitPathFinder(),this.isFinished&&this.pathFinding.InstantSolve();break;case n.End:if(e.type==n.Start||e.type==n.Wall)return;r.type=n.Empty,e.type=n.End,s.CUSTOMS.endPos=[e.row,e.col],this.InitPathFinder(),this.isFinished&&this.pathFinding.InstantSolve();break;case n.Wall:if(e.type==n.Start||e.type==n.End)return;e.type=n.Empty,this.isFinished&&this.pathFinding.InstantSolve();break;default:if(e.type==n.Start||e.type==n.End)return;e.type=n.Wall,this.isFinished&&this.pathFinding.InstantSolve();break}}}OnKeyPress(t){t.key==" "&&this.Toggle()}ToggleDiagonals(){s.CUSTOMS.useDiagonals=!s.CUSTOMS.useDiagonals,this.isFinished&&this.pathFinding.InstantSolve()}Toggle(){this.isRunning=!this.isRunning}Loop(){this.ctx.clearRect(0,0,s.SIZE,s.SIZE);for(let t in this.cells)for(let e in this.cells[t])this.cells[t][e].Draw()}Step(){if(!this.isRunning||this.isFinished)return;console.log("Stepping"),document.getElementById("useDiagonalsCheckbox").setAttribute("disabled","true"),this.pathFinding.Step()&&(this.isRunning=!1,this.pathFinding.Finish(),this.isFinished=!0,document.getElementById("useDiagonalsCheckbox").removeAttribute("disabled"))}}const u=document.getElementById("main-canvas");u.width=u.height=s.SIZE;const F=u.getContext("2d"),h=new k(F,u);console.log(h);let g=0,S=0;function w(i){requestAnimationFrame(w),(i-g)/1e3>1/s.FPS&&(g=i,h.Loop(),--S,S<=0&&(S=s.CUSTOMS.framesBettweenSteps,h.Step()))}w(0);u.addEventListener("mousemove",h.Move.bind(h));u.addEventListener("mousedown",h.Click.bind(h));document.addEventListener("keydown",h.OnKeyPress.bind(h));document.getElementById("useDiagonalsCheckbox").checked=s.CUSTOMS.useDiagonals;var C;(C=document.getElementById("useDiagonalsCheckbox"))==null||C.addEventListener("change",h.ToggleDiagonals.bind(h));document.getElementById("showCoordsCheckbox").checked=s.CUSTOMS.showCoords;var E;(E=document.getElementById("showCoordsCheckbox"))==null||E.addEventListener("change",()=>s.CUSTOMS.showCoords=!s.CUSTOMS.showCoords);document.getElementById("showGridCheckbox").checked=s.CUSTOMS.showGrid;var p;(p=document.getElementById("showGridCheckbox"))==null||p.addEventListener("change",()=>s.CUSTOMS.showGrid=!s.CUSTOMS.showGrid);var L;(L=document.getElementById("speedRange"))==null||L.addEventListener("input",i=>s.CUSTOMS.framesBettweenSteps=60-Number(i.target.value));var y;(y=document.getElementById("startButton"))==null||y.addEventListener("click",()=>h.isRunning=!0);var m;(m=document.getElementById("resetButton"))==null||m.addEventListener("click",()=>h.Reset());
